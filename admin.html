<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - CRUD with Image</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h2>ЁЯЫая╕П ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓ (ржЫржмрж┐ рж╕рж╣)</h2>
  <input type="text" id="studentId" placeholder="Student ID">
  <input type="text" id="studentName" placeholder="Name">
  <input type="text" id="studentCourse" placeholder="Course">
  <input type="password" id="studentPass" placeholder="Password">
  <input type="file" id="studentPhoto" accept="image/*"><br>
  <button onclick="addOrUpdateStudent()">тЮХ ржпрзБржХрзНржд / тЬПя╕П ржЖржкржбрзЗржЯ</button>
  <button onclick="deleteStudent()">ЁЯЧСя╕П ржорзБржЫрзБржи</button>
  <div id="status"></div>
</div>

<div class="container">
  <h3>ЁЯУЛ рж╕ржХрж▓ Student рждржерзНржп</h3>
  <div id="studentList"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="firebase.js"></script>
<script>
  const db = firebase.database();
  const storage = firebase.storage();

  function addOrUpdateStudent() {
    const id = document.getElementById("studentId").value.trim();
    const name = document.getElementById("studentName").value.trim();
    const course = document.getElementById("studentCourse").value.trim();
    const pass = document.getElementById("studentPass").value;
    const photoFile = document.getElementById("studentPhoto").files[0];

    if (!id || !name || !course || !pass) {
      alert("рж╕ржм рждржерзНржп ржжрж┐ржи!");
      return;
    }

    if (photoFile) {
      const storageRef = storage.ref("photos/" + id);
      storageRef.put(photoFile).then(snapshot => {
        snapshot.ref.getDownloadURL().then(url => {
          saveStudentData(id, name, course, pass, url);
        });
      });
    } else {
      saveStudentData(id, name, course, pass, null);
    }
  }

  function saveStudentData(id, name, course, pass, photoUrl) {
    const studentData = {
      name: name,
      course: course,
      password: pass
    };
    if (photoUrl) {
      studentData.photo = photoUrl;
    }

    db.ref("students/" + id).set(studentData).then(() => {
      document.getElementById("status").innerText = "тЬЕ рж╕ржВрж░ржХрзНрж╖ржг / ржЖржкржбрзЗржЯ рж╕ржлрж▓!";
      loadStudents();
    });
  }

  function deleteStudent() {
    const id = document.getElementById("studentId").value.trim();
    if (!id) {
      alert("Student ID ржжрж┐ржи");
      return;
    }
    db.ref("students/" + id).remove().then(() => {
      document.getElementById("status").innerText = "ЁЯЧСя╕П ржорзБржЫрзЗ ржлрзЗрж▓рж╛ рж╣ржпрж╝рзЗржЫрзЗ!";
      loadStudents();
    });
  }

  function loadStudents() {
    db.ref("students").once("value").then(snapshot => {
      const data = snapshot.val();
      const listDiv = document.getElementById("studentList");
      listDiv.innerHTML = "";
      for (let id in data) {
        const s = data[id];
        const img = s.photo ? `<br><img src="${s.photo}" width="80">` : "";
        listDiv.innerHTML += `<p><strong>${id}</strong> - ${s.name} (${s.course})${img}</p>`;
      }
    });
  }

  window.onload = loadStudents;
</script>
</body>
</html>
